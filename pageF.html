<!--https://github.com/abdmob/x2js-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>My Access</title>
    <link rel="icon" type="image/png" href="favicon.png" sizes="16x16">

    <!-- Bootstrap Core CSS -->


    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
          integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
          crossorigin="anonymous">

    <!-- Custom CSS -->


    <!--<link href="css/grayscale.css" rel="stylesheet">-->

    <!-- Custom Fonts -->

    <!-- CSS DATATABLES -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css" type="text/css">

    <!-- Bootstrap Core CSS -->
    <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="bower_components/metisMenu/dist/metisMenu.min.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.10/css/jquery.dataTables.css">


    <link href="dist/css/timeline.css" rel="stylesheet">
    <link href="dist/css/sb-admin-2.css" rel="stylesheet">
    <link href="bower_components/morrisjs/morris.css" rel="stylesheet">
    <link href="bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


</head>

<body>
<div style="padding-top: 2%">


    <div class="col-lg-12">
        <div class="well">

            <button type="button" id="btnOptions" class="btn btn-primary" title="Options" data-toggle="modal"
                    data-target="#optionsModal">
                <i class="fa fa-desktop"></i>
            </button>

            <button type="button" id="btnCleanFields" class="btn btn-warning" title="Clean Fields">
                <i class="fa fa-fire-extinguisher"></i>
            </button>

            <button type="button" id="btnNewInfo" class="btn btn-success ">
                <i class="fa  fa-plus"></i>
            </button>

            <div class="checkbox btn">
                <label>
                    <input type="checkbox" id="chkboxInBase"> based on this
                </label>
            </div>


            <form class="form-inline" role="form">


                <div class="form-group">
                    <input class="form-control" id="txtApp" placeholder="App" width="200">
                </div>

                <div class="form-group">
                    <input class="form-control" id="txtUser" placeholder="User">
                </div>

                <div class="form-group">
                    <!--<input class="form-control" type="password" id="txtPwd" placeholder="Pass" >-->
                    <div class="input-group">
                        <input type="password" class="form-control" placeholder="Pass" id="txtPwd">
                        <span class="input-group-btn">
                            <button class="btn btn-secondary" type="button" id="btnSeePwd">
                                <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                            </button>
                        </span>

                    </div>

                </div>

                <div class="form-group">
                    <input class="form-control" id="txtUrl" placeholder="Url">
                </div>

                <div class="form-group">
                    <input class="form-control" id="txtDesc" placeholder="Desc">
                </div>


            </form>


        </div>
    </div>

    <div class="col-lg-12">
        <div class="panel panel-default">
            <!--<div class="panel-heading">-->
            <!--MENU ELEMENTS (TABLE)-->
            <!--</div>-->
            <div class="panel-body panelTable">

                <!-- MESSAGES-->
                <div class="alert alert-success" id="lableWarningSuccess" style="display: none">
                    <h5>Example heading Lorem ipsum dolor sit amet, consectetur adipisicing elit. <a href="#"
                                                                                                     class="alert-link">Alert
                        Link</a>.
                    </h5>
                </div>
                <div class="alert alert-warning" id="lableWarning" style="display: none">
                    <h5>Example heading Lorem ipsum dolor sit amet, consectetur adipisicing elit. <a href="#"
                                                                                                     class="alert-link">Alert
                        Link</a>.
                    </h5>
                </div>
                <div class="alert alert-danger" id="lableWarningDanger" style="display: none">
                    <h5>Example heading Lorem ipsum dolor sit amet, consectetur adipisicing elit. <a href="#"
                                                                                                     class="alert-link">Alert
                        Link</a>.
                    </h5>
                </div>


                <div id="divTableListAllInfo">


                </div>


            </div>
            <!-- /.panel-body -->
        </div>
        <!-- /.panel -->
    </div>

    <div class="panel-body">
        <!-- Button trigger modal -->
        <!--<button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#optionsModal">-->
        <!--Launch Demo Modal-->
        <!--</button>-->
        <!-- Modal -->
        <div class="modal fade" id="optionsModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
             aria-hidden="true" style="display: none;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                        <h4 class="modal-title" id="myModalLabel">Options</h4>
                    </div>
                    <div class="modal-body">

                        <h4>Export to File (CSV) </h4>
                        <button class="btn btn-primary btn-sm" id="btnSaveToFile">
                            Download File
                        </button>

                        <h4>Import Data(CSV) </h4>


                        <div class="form-inline">
                            <div class="form-group">
                                <input type="file" id="importfile" class="filestyle form-control"/>
                                <button class="btn btn-primary btn-sm form-control" id="btnImportFile"
                                        onclick="CSVtoJSONConvertor()">
                                    Import File
                                </button>
                            </div>
                        </div>


                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <!--<button type="button" class="btn btn-primary">Save changes</button>-->
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->
    </div>


</div>

<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->


<!-- DATATABLES JavaScript-->
<!--<script src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>-->

<script src="bower_components/jquery/dist/jquery.min.js"></script>
<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="bower_components/metisMenu/dist/metisMenu.min.js"></script>
<script src="bower_components/raphael/raphael-min.js"></script>
<script src="bower_components/morrisjs/morris.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.10/js/jquery.dataTables.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/plug-ins/1.10.11/api/fnReloadAjax.js"></script>

<!--DROPBOX SDK-->
<script src="https://www.dropbox.com/static/api/dropbox-datastores-1.2-latest.js" type="text/javascript"></script>


<script src="dist/js/sb-admin-2.js"></script>


<script>

    var btnNewInfo = '#btnNewInfo';
    var btnCleanFields = '#btnCleanFields';
    var txtApp = '#txtApp';
    var txtUser = '#txtUser';
    var txtPwd = '#txtPwd';
    var txtUrl = '#txtUrl';
    var txtDesc = '#txtDesc';
    var divTableListAllInfo = '#divTableListAllInfo';
    var tableListElements = '#tableListAllInfo';
    var chkboxInBase = '#chkboxInBase';
    var btnSaveToFile = '#btnSaveToFile';
    var btnImportFile = '#btnImportFile';
    var lableWarningSuccess = '#lableWarningSuccess';
    var lableWarning = '#lableWarning';
    var lableWarningDanger = '#lableWarningDanger';
    var updateID = '';
    var btnSeePwd = '#btnSeePwd';

    var tableObjDTable = '';

    var noDataInStorage = 'Not data in the Storage.';
    var updatedLineString = 'Element <b>Updated</b> with <b>Success</b>';
    var insertLineString = 'Element <b>Inserted</b> with <b>Success</b>';
    var deleteLineString = 'Element <b>DELETED</b> with <b>Success</b>';
    var fileDownloadString = ' File Export with <b>Success</b>. See your <b>Download folder</b>.';


    var Base64 = {
        _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", encode: function (e) {
            var t = "";
            var n, r, i, s, o, u, a;
            var f = 0;
            e = Base64._utf8_encode(e);
            while (f < e.length) {
                n = e.charCodeAt(f++);
                r = e.charCodeAt(f++);
                i = e.charCodeAt(f++);
                s = n >> 2;
                o = (n & 3) << 4 | r >> 4;
                u = (r & 15) << 2 | i >> 6;
                a = i & 63;
                if (isNaN(r)) {
                    u = a = 64
                } else if (isNaN(i)) {
                    a = 64
                }
                t = t + this._keyStr.charAt(s) + this._keyStr.charAt(o) + this._keyStr.charAt(u) + this._keyStr.charAt(a)
            }
            return t
        }, decode: function (e) {
            var t = "";
            var n, r, i;
            var s, o, u, a;
            var f = 0;
            e = e.replace(/[^A-Za-z0-9\+\/\=]/g, "");
            while (f < e.length) {
                s = this._keyStr.indexOf(e.charAt(f++));
                o = this._keyStr.indexOf(e.charAt(f++));
                u = this._keyStr.indexOf(e.charAt(f++));
                a = this._keyStr.indexOf(e.charAt(f++));
                n = s << 2 | o >> 4;
                r = (o & 15) << 4 | u >> 2;
                i = (u & 3) << 6 | a;
                t = t + String.fromCharCode(n);
                if (u != 64) {
                    t = t + String.fromCharCode(r)
                }
                if (a != 64) {
                    t = t + String.fromCharCode(i)
                }
            }
            t = Base64._utf8_decode(t);
            return t
        }, _utf8_encode: function (e) {
            e = e.replace(/\r\n/g, "\n");
            var t = "";
            for (var n = 0; n < e.length; n++) {
                var r = e.charCodeAt(n);
                if (r < 128) {
                    t += String.fromCharCode(r)
                } else if (r > 127 && r < 2048) {
                    t += String.fromCharCode(r >> 6 | 192);
                    t += String.fromCharCode(r & 63 | 128)
                } else {
                    t += String.fromCharCode(r >> 12 | 224);
                    t += String.fromCharCode(r >> 6 & 63 | 128);
                    t += String.fromCharCode(r & 63 | 128)
                }
            }
            return t
        }, _utf8_decode: function (e) {
            var t = "";
            var n = 0;
            var r = c1 = c2 = 0;
            while (n < e.length) {
                r = e.charCodeAt(n);
                if (r < 128) {
                    t += String.fromCharCode(r);
                    n++
                } else if (r > 191 && r < 224) {
                    c2 = e.charCodeAt(n + 1);
                    t += String.fromCharCode((r & 31) << 6 | c2 & 63);
                    n += 2
                } else {
                    c2 = e.charCodeAt(n + 1);
                    c3 = e.charCodeAt(n + 2);
                    t += String.fromCharCode((r & 15) << 12 | (c2 & 63) << 6 | c3 & 63);
                    n += 3
                }
            }
            return t
        }
    }


    $(document).ready(function () {

        getStorage();

        $(btnSeePwd).hover(
                function () {
                    $(txtPwd).attr('type', 'text');
                }, function () {
                    $(txtPwd).attr('type', 'password');
                }
        );


        $(btnSaveToFile).on('click', function () {
            //alert(' File Export \n See your Download folder.');

            var object = JSON.parse(localStorage.getItem('info'));

            var data = object;
            if (data == '')
                return;

            JSONToCSVConvertor(data, "", true);

            $('#optionsModal').modal('hide');
            showTemporaryMessageLabel(lableWarningSuccess, fileDownloadString, true);

        });

        $(btnCleanFields).on('click', function () {
            cleanFields();

        });


        //click add new
        $(btnNewInfo).on('click', function () {


            if (verifyFields($(txtApp).val(), $(txtUser).val())) {

                var ckboxStatus = $('#chkboxInBase').prop('checked');

                if (updateID == '' || ckboxStatus == true) {
                    alert('create');
                    var timeDate = getDateTime();

                    var id = timeDate;
                    var app = $(txtApp).val();
                    var user = $(txtUser).val();
                    var pwd = $(txtPwd).val();
                    var url = $(txtUrl).val();
                    var desc = $(txtDesc).val();

                    var newlineList = {};
                    newlineList.id = id;
                    newlineList.application = app;
                    newlineList.user = user;
                    newlineList.pwd = pwd;
                    newlineList.url = url;
                    newlineList.desc = desc;

                    console.log(newlineList);
                    // UPDATE STORAGE
                    setStorage(newlineList);

                    //reloadPage();

                    getStorage();
                    cleanFields();

                    showTemporaryMessageLabel(lableWarningSuccess, insertLineString, true);

                } else {
                    //update
//                    alert('update');

                    var objecBefore = JSON.parse(localStorage.getItem('info'));
                    var objectUpdated = [];

                    for (var i = 0; i < objecBefore.length; i++) {

                        var listUpdated = {};
                        var app = $(txtApp).val();
                        var user = $(txtUser).val();
                        var pwd = $(txtPwd).val();
                        var url = $(txtUrl).val();
                        var desc = $(txtDesc).val();

                        if (objecBefore[i].id == updateID) {
                            listUpdated.id = updateID.toString();
                            listUpdated.application = app;
                            listUpdated.user = user;
                            listUpdated.pwd = pwd;
                            listUpdated.url = url;
                            listUpdated.desc = desc;
                        } else {
                            listUpdated.id = objecBefore[i].id;
                            listUpdated.application = objecBefore[i].application;
                            listUpdated.user = objecBefore[i].user;
                            listUpdated.pwd = objecBefore[i].pwd;
                            listUpdated.url = objecBefore[i].url;
                            listUpdated.desc = objecBefore[i].desc;

                        }

                        objectUpdated.push(listUpdated);
                        console.log(objectUpdated);
                    }

                    updateStorage(objectUpdated);


//                    reloadPage();
                    getStorage();
                    cleanFields();

                    showTemporaryMessageLabel(lableWarning, updatedLineString, true);

                }
            } else {
                alert('Campos Obrigatorios\n    Application\n   Username');
            }


        });


    });


    function deleteStorage(deleteID) {
        var objectUpdated = [];

        var objecBefore = JSON.parse(localStorage.getItem('info'));

        for (var i = 0; i < objecBefore.length; i++) {
            if (objecBefore[i].id != deleteID) {
                var listUpdated = {};

                listUpdated.id = objecBefore[i].id;
                listUpdated.application = objecBefore[i].application;
                listUpdated.user = objecBefore[i].user;
                listUpdated.pwd = objecBefore[i].pwd;
                listUpdated.url = objecBefore[i].url;
                listUpdated.desc = objecBefore[i].desc;

                objectUpdated.push(listUpdated);

            }

        }

        updateStorage(objectUpdated);


    }

    function updateStorage(newListToUpdate) {

        localStorage.setItem('info', JSON.stringify(newListToUpdate));


    }

    function setStorage(newlineForTheList) {
        var ObjectNotUpdated = JSON.parse(localStorage.getItem('info'));
        if (ObjectNotUpdated == null) {
            var arrayForObject = [];
            arrayForObject.push(newlineForTheList);
            localStorage.setItem('info', JSON.stringify(arrayForObject));

        } else {
            ObjectNotUpdated.push(newlineForTheList);
            localStorage.setItem('info', JSON.stringify(ObjectNotUpdated));
        }

    }


    function getStorage() {

        var storageObject = JSON.parse(localStorage.getItem('info'));

        if (storageObject != null) {
            //ADICIONAR A TABELA
            createLinesToTable(storageObject);
        } else {
            //WARNING

            showTemporaryMessageLabel(lableWarningDanger, noDataInStorage, false);
        }


    }

    function createTempTHeader() {
        var tblheader = '';
        tblheader += '<thead>';
        tblheader += '    <th>Application</th>';
        tblheader += '    <th>Uer</th>';
        tblheader += '    <th>Pass</th>';
        tblheader += '    <th>Location</th>';
        tblheader += '    <th>Desc</th>';
        tblheader += '    <th></th>';
        tblheader += '    <th></th>';
        tblheader += '</thead>';

        return tblheader;

    }

    function createTempTBody(i, id, app, user, pass, url, desc) {
        var tblbodyline = '';

        tblbodyline += '<tr>';
        tblbodyline += '<td>' + app + '</td>';
        tblbodyline += '<td>' + user + '</td>';

        if (pass) {
            tblbodyline += '<td> <button  class="btnCopyToClipboard btn-success" data-id="' + i + '"> <i class="fa fa-copy"></i> </button> <span style="display:none" id="spam_' + i + '"> ' + pass + '</span>  </td>';
        } else {
            tblbodyline += '<td> </td>';
        }


        if (url != undefined) {
            var messageLink = 'Open Link';
            if (url.search('http') == 0) {
                tblbodyline += '<td> <a target="_blank" href=' + url + '>' + messageLink.link(url) + ' </a> </td>';
            } else {
                tblbodyline += '<td>' + url + '</td>';
            }
        } else {
            tblbodyline += '<td> </td>';

        }


        tblbodyline += '<td>' + desc + '</td>';

        tblbodyline += '<td>';

        tblbodyline += '<button type="button" style="width: 100%" class="editLine btn-warning" ';
        id !== "" ? tblbodyline += ' data-idelement="' + id + '"' : console.log('no data in app -> ');
        app !== "" ? tblbodyline += ' data-app="' + app + '"' : console.log('no data in app -> ' + i);
        user != "" ? tblbodyline += ' data-user=' + user : console.log('no data in user -> ' + i);
        pass != "" ? tblbodyline += ' data-pwd=' + pass : console.log('no data in pass -> ' + i);
        url != "" ? tblbodyline += ' data-url=' + url : console.log('no data in url -> ' + i);
        desc != "" ? tblbodyline += ' data-desc=' + desc : console.log('no data in desc -> ' + i);

        tblbodyline += ' ><i class="fa fa-pencil"> </i>  ';
        tblbodyline += '</button>';
        tblbodyline += '</td>';

        tblbodyline += '<td> <button type="button" style="width: 100%" class="deleteLine btn-danger" data-idelement=' + id + '> <i class="fa fa-times"></i> </button> </td>';

        tblbodyline += '</tr>';

        return tblbodyline;


    }

    function createTable(theader, tbody) {
        var table = '';

        table += '<table id="tableListAllInfo" class="display compact" cellspacing="0">';
        table += theader;
        table += tbody;
        table += '</table>';

        return table;

    }

    function convertTableToDataTable() {

        tableObjDTable = $(tableListElements).DataTable({
            "aLengthMenu": [[15, 25, 50, 80, 100, -1], [15, 25, 50, 80, 100, "All"]],
            "iDisplayLength": -1,
            "aoColumnDefs": [{
                'bSortable': false,
                'aTargets': [2, 3, 4, 5, 6]
            }],
            "bDestroy": true
        });
    }

    function createLinesToTable(lineToTable) {

        var lines = '';

        if (lineToTable.length) {

            for (var i = 0; i < lineToTable.length; i++) {
                var id = lineToTable[i].id;
                var app = lineToTable[i].application;
                var user = lineToTable[i].user;
                var pass = lineToTable[i].pwd;
                var url = lineToTable[i].url;
                var desc = lineToTable[i].desc;

                lines += createTempTBody(i, id, app, user, pass, url, desc);

            }

        } else {
            var id = lineToTable.id;
            var app = lineToTable.application;
            var user = lineToTable.user;
            var pass = lineToTable.pwd;
            var url = lineToTable.url;
            var desc = lineToTable.desc;

            lines += createTempTBody(1, id, app, user, pass, url, desc);

        }


        // CREATE ALL TABLE

        var tHeader = createTempTHeader();
        var tBody = '';
        tBody += '<tbody>';
        tBody += lines;
        tBody += '</tbody>';

        var tFinal = createTable(tHeader, tBody);

        $(divTableListAllInfo).empty();

        $(divTableListAllInfo).append(tFinal);

        convertTableToDataTable();

        $('.editLine').on('click', function () {
            var id = '';
            var app = '';
            var user = '';
            var pwd = '';
            var url = '';
            var desc = '';

            if ($(this).data('idelement'))
                id = $(this).data('idelement');
            if ($(this).data('app'))
                app = $(this).data('app');
            if ($(this).data('user'))
                user = $(this).data('user');
            if ($(this).data('pwd'))
                pwd = $(this).data('pwd');
            if ($(this).data('url'))
                url = $(this).data('url');
            if ($(this).data('desc'))
                desc = $(this).data('desc');


            cleanFields();
            updateID = id;
            $(txtApp).val(app);
            $(txtUser).val(user);
            $(txtPwd).val(pwd);
            $(txtUrl).val(url);
            $(txtDesc).val(desc);
            scrollUp();


        });


        $('.deleteLine').on('click', function () {
//            alert('delete ??');

            var idDelete = $(this).data('idelement');

            deleteStorage(idDelete);

            getStorage();


            showTemporaryMessageLabel(lableWarningDanger, deleteLineString, true);


//            scrollUp();

        });


        $('#tableListAllInfo tr td .btnCopyToClipboard').on('mousedown', function (event) {

            var id = $(this).data('id');
            var element = "spam_" + id;

            if (event.which == 1) {
                copyToClipboardMsg(document.getElementById(element), "msg");
            }

            if (event.which == 2) {

                event.preventDefault();

                if ($('#' + element).css('display') == 'none') {
                    $('#' + element).css('display', "block")
                } else {
                    $('#' + element).css('display', "none")
                }

            }

        });


    }


    ////////////////
    function copyToClipboardMsg(elem, msgElem) {
        var succeed = copyToClipboard(elem);
        var msg;
        if (!succeed) {
//            msg = "Copy not supported or blocked.  Press Ctrl+c to copy."
            console.log("Copy not supported or blocked.  Press Ctrl+c to copy.");
        } else {
//            msg = "Text copied to the clipboard."
            console.log("Text copied to the clipboard.");
        }
        if (typeof msgElem === "string") {
            msgElem = document.getElementById(msgElem);
        }
    }


    function copyToClipboard(elem) {
        // create hidden text element, if it doesn't already exist
        var targetId = "_hiddenCopyText_";
        var isInput = elem.tagName === "INPUT" || elem.tagName === "TEXTAREA";
        var origSelectionStart, origSelectionEnd;
        if (isInput) {
            // can just use the original source element for the selection and copy
            target = elem;
            origSelectionStart = elem.selectionStart;
            origSelectionEnd = elem.selectionEnd;
        } else {
            // must use a temporary form element for the selection and copy
            target = document.getElementById(targetId);
            if (!target) {
                var target = document.createElement("textarea");
                target.style.position = "absolute";
                target.style.left = "-9999px";
                target.style.top = "0";
                target.id = targetId;
                document.body.appendChild(target);
            }
            target.textContent = elem.textContent;
        }
        // select the content
        var currentFocus = document.activeElement;
        target.focus();
        target.setSelectionRange(0, target.value.length);

        // copy the selection
        var succeed;
        try {
            succeed = document.execCommand("copy");
        } catch (e) {
            succeed = false;
        }
        // restore original focus
        if (currentFocus && typeof currentFocus.focus === "function") {
            currentFocus.focus();
        }

        if (isInput) {
            // restore prior selection
            elem.setSelectionRange(origSelectionStart, origSelectionEnd);
        } else {
            // clear temporary content
            target.textContent = "";
        }
        return succeed;
    }


    /* ------------- JSON - CSV - JSON -----------------    */
    var jsonObject = '';
    function JSONToCSVConvertor(JSONData, ReportTitle, ShowLabel) {
        //If JSONData is not an object then JSON.parse will parse the JSON string in an Object
        var arrData = typeof JSONData != 'object' ? JSON.parse(JSONData) : JSONData;

        var CSV = '';
        var row = "";

        //This loop will extract the label from 1st index of on array
        for (var index in arrData[0]) {
            //Now convert each value to string and comma-seprated
            row += index + ',';
        }

        row = row.slice(0, -1);
        row += '\n';

        CSV += row;

        CSV += ConvertToCSV(arrData);

        if (CSV == '') {
            alert("Invalid data");
            return;
        }

        //Generate a file name
        var fileName = "MyInfo_ " + getDateTime();
        //this will remove the blank-spaces from the title and replace it with an underscore
        fileName += ReportTitle.replace(/ /g, "_");

        var uri = 'data:text/csv;charset=utf-8,' + escape(CSV);

        // NOTES:
        // Now the little tricky part.
        // you can use either>> window.open(uri);
        // but this will not work in some browsers --> IE
        // or you will not get the correct file extension
        //this trick will generate a temp <a /> tag
        var link = document.createElement("a");
        link.href = uri;

        //set the visibility hidden so it will not effect on your web-layout
        link.style = "visibility:hidden";
        link.download = fileName + ".csv";

        //this part will append the anchor tag and remove it after automatic click
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }


    function ConvertToCSV(objArray) {
//        var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;
        var array = objArray;
        var str = '';

        for (var i = 0; i < array.length; i++) {
            var line = '';
            for (var index in array[i]) {
                if (line != '') line += ',';

                line += array[i][index];
            }

            str += line + '\n';
        }

        return str;
    }


    function CSVtoJSONConvertor() {

        var arrayTempImport = [];

        var fileUpload = document.getElementById("importfile");
        var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.csv)$/;

        if (regex.test(fileUpload.value.toLowerCase())) {
            if (typeof (FileReader) != "undefined") {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var table = document.createElement("table");
                    var rows = e.target.result.split("\n");

                    var firstLine = rows[0].split(',');
                    var firstColumn = firstLine[0];

                    for (var i = 1; i < rows.length - 1; i++) {
                        //Dont get header line
                        var row = table.insertRow(-1);
                        var cells = rows[i].split(",");

                        var newLineTemp = {};

                        //VERIFICAR SE EXISTE COLUNA DO ID

                        if (firstColumn == 'id') {
                            if (cells[0] != undefined) newLineTemp.id = cells[0]; else  newLineTemp.id = "";
                            if (cells[1] != undefined) newLineTemp.application = cells[1]; else newLineTemp.application = "";
                            if (cells[2] != undefined) newLineTemp.user = cells[2]; else newLineTemp.user = "";
                            if (cells[3] != undefined) newLineTemp.pwd = cells[3]; else newLineTemp.pwd = "";
                            if (cells[4] != undefined) newLineTemp.url = cells[4]; else newLineTemp.url = "";
                            if (cells[5] != undefined) newLineTemp.desc = cells[5]; else newLineTemp.desc = "";
                        } else {
                            newLineTemp.id = getDateTime();
                            if (cells[0] != undefined) newLineTemp.application = cells[1]; else newLineTemp.application = "";
                            if (cells[1] != undefined) newLineTemp.user = cells[2]; else newLineTemp.user = "";
                            if (cells[2] != undefined) newLineTemp.pwd = cells[3]; else newLineTemp.pwd = "";
                            if (cells[3] != undefined) newLineTemp.url = cells[4]; else newLineTemp.url = "";
                            if (cells[4] != undefined) newLineTemp.desc = cells[5]; else newLineTemp.desc = "";

                        }

                        arrayTempImport.push(newLineTemp);

                    }


                    localStorage.setItem('info', JSON.stringify(arrayTempImport));

                    getStorage();

                    $('#optionsModal').modal('hide');

                    cleanFields();

                }
                reader.readAsText(fileUpload.files[0]);

                //console.log(csvArray);


            } else {
                alert("This browser does not support HTML5.");
            }
        } else {
            alert("Please upload a valid CSV file.");
        }


    }


    function CSVToArray(strData, strDelimiter) {
        strDelimiter = (strDelimiter || ",");
        var objPattern = new RegExp((
        "(\\" + strDelimiter + "|\\r?\\n|\\r|^)" +
        "(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|" +
        "([^\"\\" + strDelimiter + "\\r\\n]*))"), "gi");
        var arrData = [[]];
        var arrMatches = null;
        while (arrMatches = objPattern.exec(strData)) {
            var strMatchedDelimiter = arrMatches[1];
            if (strMatchedDelimiter.length && (strMatchedDelimiter != strDelimiter)) {
                arrData.push([]);
            }
            if (arrMatches[2]) {
                var strMatchedValue = arrMatches[2].replace(
                        new RegExp("\"\"", "g"), "\"");
            } else {
                var strMatchedValue = arrMatches[3];
            }
            arrData[arrData.length - 1].push(strMatchedValue);
        }
        return (arrData);
    }

    function CSV2JSON(csv) {
        var array = CSVToArray(csv);
        var objArray = [];
        for (var i = 1; i < array.length; i++) {
            objArray[i - 1] = {};
            for (var k = 0; k < array[0].length && k < array[i].length; k++) {
                var key = array[0][k];
                objArray[i - 1][key] = array[i][k]
            }
        }

        var json = JSON.stringify(objArray);
        var str = json.replace(/},/g, "},\r\n");

        return str;
    }


    function getDateTime() {
        var dt = new Date();
        var datetime = dt.getDate() + '' + (dt.getMonth() + 1) + "" + dt.getFullYear() + "" + dt.getHours() + "" + dt.getMinutes() + "" + dt.getSeconds();

        return datetime;
    }


    function verifyFields(app, user) {
        var validate = false;

        if (app != "" && user != "")
            validate = true;


        return validate;
    }

    function showTemporaryMessageLabel(warningType, messageShow, isfadeout) {

        $(warningType + ' h5').empty();
        $(warningType + ' h5').append(messageShow);
        $(warningType).show();

        if (isfadeout) {
            $(warningType).delay(1800).fadeOut(300);
        }

    }

    function scrollUp() {
        $('body').scrollTop(0);
        $(window).scrollTop();
    }

    function reloadPage() {
        location.reload();
    }

    function cleanFields() {
        updateID = '';
        $(txtApp).val('');
        $(txtUser).val('');
        $(txtPwd).val('');
        $(txtUrl).val('');
        $(txtDesc).val('');
        $(chkboxInBase).prop('checked', false);

        if ($(lableWarning).is(':visible')) $(lableWarning).hide();
        if ($(lableWarningDanger).is(':visible')) $(lableWarningDanger).hide();
        if ($(lableWarningSuccess).is(':visible')) $(lableWarningSuccess).hide();

    }

</script>


</body>


</html>